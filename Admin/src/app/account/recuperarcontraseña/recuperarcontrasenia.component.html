
<div *ngIf="mostrarOverlayCarga" class="overlay-carga d-flex align-items-center justify-content-center">
  <div class="typing-indicator">
    <div class="typing-circle"></div>
    <div class="typing-circle"></div>
    <div class="typing-circle"></div>
    <div class="typing-shadow"></div>
    <div class="typing-shadow"></div>
    <div class="typing-shadow"></div>
  </div>
</div>


<!-- Pantalla para confirmar la nueva contraseña -->
<div class="login-card recuperar-responsive-card" *ngIf="mostrarPantallaConfirmar">
  <div class="d-flex flex-column align-items-center w-100">
    <div class="mb-4">
      <i class="ri-key-line" style="font-size: 4.5rem; color: #d6b68a;"></i>
    </div>
    <h2 class="login-title text-center">Confirmar Contraseña</h2>
    <div class="login-subtitle text-center" style="color:#fff; font-size:1.08rem; margin-bottom:1.5rem; opacity:0.85;">
      Ingrese la nueva contraseña para terminar el proceso
    </div>
    <form class="login-form w-100" autocomplete="off">
      <div class="login-input-group w-100" style="max-width: 400px; margin: 0 auto;">
        <label for="nuevaContrasena" class="login-label">Nueva Contraseña</label>
        <div class="login-input-icon">
          <input
            [type]="mostrarPassword1 ? 'text' : 'password'"
            [(ngModel)]="nuevaContrasena"
            name="nuevaContrasena"
            id="nuevaContrasena"
            placeholder="Nueva Contraseña"
            style="padding-right:2.5rem; width: 100%;"
          />
          <i class="ri-eye-line" *ngIf="!mostrarPassword1" (click)="mostrarPassword1 = true" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"></i>
          <i class="ri-eye-off-line" *ngIf="mostrarPassword1" (click)="mostrarPassword1 = false" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"></i>
        </div>
        <div class="text-danger mt-1" *ngIf="!nuevaContrasena.trim() && mostrarErroresConfirmar">
          <small>El campo Nueva Contraseña es requerido</small>
        </div>
      </div>
      <div class="login-input-group w-100" style="max-width: 400px; margin: 0 auto;">
        <label for="confirmarContrasena" class="login-label">Confirmar Nueva Contraseña</label>
        <div class="login-input-icon">
          <input
            [type]="mostrarPassword2 ? 'text' : 'password'"
            [(ngModel)]="confirmarContrasena"
            name="confirmarContrasena"
            id="confirmarContrasena"
            placeholder="Confirmar Nueva Contraseña"
            style="padding-right:2.5rem; width: 100%;"
          />
          <i class="ri-eye-line" *ngIf="!mostrarPassword2" (click)="mostrarPassword2 = true" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"></i>
          <i class="ri-eye-off-line" *ngIf="mostrarPassword2" (click)="mostrarPassword2 = false" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"></i>
        </div>
        <div class="text-danger mt-1" *ngIf="!confirmarContrasena.trim() && mostrarErroresConfirmar">
          <small>El campo Confirmar Nueva Contraseña es requerido</small>
        </div>
      </div>
      <div class="codigo-btn-row d-flex flex-column flex-sm-row justify-content-center align-items-center w-100 mt-4 gap-2 gap-sm-3">
        <button type="button" class="btn btn-login w-100 w-sm-auto" (click)="regresarConfirmar()">
          <i class="ri-arrow-left-line"></i>
          <span class="btn-text">Regresar</span> 
        </button>
        <button type="button" class="btn btn-login gold w-100 w-sm-auto" (click)="confirmarNuevaContrasena()">
          <i class="ri-checkbox-circle-line"></i>
          <span class="btn-text">Confirmar</span>
        </button>
      </div>
    </form>
  </div>
</div>


<!-- Pantalla para ingresar el código de recuperación -->
<div class="login-card recuperar-responsive-card" *ngIf="mostrarPantallaCodigo">
  <div class="codigo-card-content w-100">
    <div class="codigo-icon">
      <i class="ri-mail-send-line" style="font-size: 4.5rem;"></i>
    </div>
    <h2 class="login-title">Ingresar Código</h2>
    <div class="login-subtitle">
      Ingrese el código enviado a su correo electrónico para continuar el restablecimiento de contraseña
    </div>
    <div class="codigo-inputs d-flex justify-content-center flex-wrap gap-2" style="max-width: 350px; margin: 0 auto;">
      <ng-container *ngFor="let i of [0,1,2,3,4,5]; let idx = index">
        <input
          maxlength="1"
          class="codigo-input"
          type="text"
          [(ngModel)]="codigoIngresado[i]"
          name="codigo{{i}}"
          #codeInput{{i}}
          [value]="codigoIngresado[i] === '0' ? '' : codigoIngresado[i]"
          (input)="onInputKeyUp($event, i)"
        />
      </ng-container>

    </div>
<div class="codigo-btn-row d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 gap-sm-3 w-100 mt-3">
      <button type="button" class="btn btn-login" (click)="cancelarPantallaCodigo()">
        <i class="ri-arrow-left-line"></i>
        <span class="btn-text">Regresar</span>
      </button>
      <button type="button" class="btn btn-login gold" (click)="confirmarCodigo()">
        <i class="ri-checkbox-circle-line"></i>
        <span class="btn-text">Confirmar</span>
      </button>
    </div>
      <div class="login-forgot" *ngIf="mostrarPantallaCodigo">
        <a (click)="reenviarcodigo()" [ngStyle]="{'cursor': reenviarDisabled ? 'not-allowed' : 'pointer', 'color': reenviarDisabled ? '#aaa' : ''}" [class.disabled]="reenviarDisabled">
          Reenviar Código
          <span *ngIf="reenviarDisabled"> ({{ tiempoRestante }}s)</span>
        </a>
      </div>
  </div>
</div>
<div class="login-card recuperar-responsive-card" *ngIf="!mostrarPantallaCodigo && !mostrarPantallaConfirmar">
  <div></div>
  <h2 class="login-title text-center">Restablecer Contraseña</h2>
  <div class="login-subtitle text-center">
    Ingrese su usuario y recibirá un correo con el código para reestablecer su contraseña
  </div>
  <form class="login-form w-100">
    <div class="login-input-group w-100" style="max-width: 400px; margin: 0 auto;">
      <label for="usuario" class="login-label">Usuario</label>
      <div class="login-input-icon">
        <i class="ri-user-line"></i>
        <input type="text" [(ngModel)]="usuario.usua_Usuario" name="usua_Usuario" id="usuario" placeholder="Usuario" style="width: 100%;"/>
      </div>
      <div class="text-danger mt-1" *ngIf="!usuario.usua_Usuario.trim() && mostrarErrores">
        <small>El campo Usuario es requerido</small>
      </div>
    </div>
  </form>
  <hr>
      <div class="codigo-btn-row" style="display: flex; justify-content: center; gap: 1rem;">
      <button type="button" class="btn btn-login" (click)="cancelar()">
        <i class="ri-arrow-left-line"></i>
        <span class="btn-text">Regresar</span>
      </button>
      <button type="button" class="btn btn-login" (click)="verificarusuario()">
        <span class="btn-text">Enviar</span>
        <i class="ri-send-plane-2-line"></i>
      </button>
    </div>
</div>





<!-- Contenedor de alertas flotantes -->
<div class="alert-container">
  <div *ngIf="mostrarAlertaExito" class="alert alert-success alert-border-left alert-dismissible fade show floating-alert" role="alert">
    <i class="ri-check-double-line me-3 align-middle fs-lg"></i>
    <strong>¡Éxito!</strong> {{ mensajeExito }}
    <button type="button" class="btn-close" (click)="cerrarAlerta()" aria-label="Close"></button>
  </div>

  <div *ngIf="mostrarAlertaWarning" class="alert alert-warning alert-border-left alert-dismissible fade show floating-alert" role="alert">
    <i class="ri-alert-line me-3 align-middle fs-lg"></i>
    <strong>¡Atención!</strong> {{ mensajeWarning }}
    <button type="button" class="btn-close" (click)="cerrarAlerta()" aria-label="Close"></button>
  </div>

  <div *ngIf="mostrarAlertaError" class="alert alert-danger alert-border-left alert-dismissible fade show floating-alert" role="alert">
    <i class="ri-error-warning-line me-3 align-middle fs-lg"></i>
    <strong>¡Error!</strong> {{ mensajeError }}
    <button type="button" class="btn-close" (click)="cerrarAlerta()" aria-label="Close"></button>
  </div>
</div>