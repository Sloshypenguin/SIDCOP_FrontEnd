<app-breadcrumbs [title]="'Usuarios'" [breadcrumbItems]="[
        { label: 'Acceso' },
        { label: 'Usuarios', active: true }
    ]">
    <img class="breadcrumbs-icon ms-2 icon-breadcrumb" src="assets/images/imagenes/Vector.svg" alt="icono breadcrumb" />
</app-breadcrumbs>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between mb-3 flex-wrap"
                    *ngIf="!showCreateForm && !showEditForm && !showDetailsForm">
                    <button *ngIf="accionPermitida('crear')" type="button" class="btn btn-primary me-2 mb-2"
                        (click)="crear()">
                        <span class="btn-text">Nuevo</span>
                        <span class="btn-icon"><i class="ri-add-line"></i></span>
                    </button>
                    <div class="search-box mb-2">
                        <input type="text" class="form-control search" placeholder="Buscar..."
                            [(ngModel)]="table.searchTerm" (ngModelChange)="table.setSearchTerm($event)">
                        <i class="ri-search-line search-icon"></i>
                    </div>
                </div>

                <!-- Collapse Crear -->
                <div class="collapse" [ngClass]="{ 'show': showCreateForm }" id="createFormCollapse">
                    <div class="card card-body mb-3" style="min-height: 300px; padding: 2rem;">
                        <div class="container-fluid">
                        </div>
                    </div>
                </div>

                <!-- Collapse Editar -->
                <div class="collapse" [ngClass]="{ 'show': showEditForm }" id="editFormCollapse">
                    <div class="card card-body mb-3" style="min-height: 300px; padding: 2rem;">
                        <div class="container-fluid">
                        </div>
                    </div>
                </div>

                <!-- Collapse Detalles -->
                <div class="collapse" [ngClass]="{ 'show': showDetailsForm }" id="detailsFormCollapse">
                    <div class="card card-body mb-3" style="min-height: 400px; padding: 0.5rem;">
                        <div class="container-fluid">
                        </div>
                    </div>
                </div>

                <!-- Tabla -->
                <div class="table-responsive" *ngIf="!showCreateForm && !showEditForm && !showDetailsForm">
                    <table class="table table-gridjs table-style">
                        <thead>
                            <tr>
                                <th
                                    *ngIf="accionPermitida('editar') || accionPermitida('eliminar') || accionPermitida('detalle')">
                                    Acciones</th>
                                <th>Usuario</th>
                                <th>Descripción del Rol</th>
                                <th>¿Es Admin?</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let data of table.paginated$ | async; let i = index">
                                <td
                                    *ngIf="accionPermitida('editar') || accionPermitida('eliminar') || accionPermitida('detalle')">
                                    <div class="dropdown-action-list">
                                        <button type="button" class="dropdown-toggle"
                                            [attr.aria-expanded]="activeActionRow === i" (click)="onActionMenuClick(i)">
                                            <span>Acciones</span>
                                            <i class="ri-settings-3-line"></i>
                                        </button>
                                        <ul *ngIf="activeActionRow === i" class="dropdown-menu show">
                                            <li *ngIf="accionPermitida('editar')">
                                                <button class="dropdown-action-btn" (click)="editar(data)">Editar <i
                                                        class="ri-edit-line"></i></button>
                                            </li>
                                            <li *ngIf="accionPermitida('eliminar')">
                                                <button class="dropdown-action-btn"
                                                    (click)="confirmarEliminar(data)">Eliminar <i
                                                        class="ri-delete-bin-line"></i></button>
                                            </li>
                                            <li *ngIf="accionPermitida('detalle')">
                                                <button class="dropdown-action-btn" (click)="detalles(data)">Detalles
                                                    <i class="ri-error-warning-fill"></i></button>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                                <td>{{ data.usua_Usuario }}</td>
                                <td>{{ data.role_Descripcion }}</td>
                                <td>{{ data.usua_EsAdmin ? 'Sí' : 'No' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Paginación -->
                <div class="row justify-content-md-between align-items-md-center"
                    *ngIf="!showCreateForm && !showEditForm && !showDetailsForm">
                    <ng-container *ngIf="(table.paginated$ | async) as paginados">
                        <div class="col-sm-12 col-md-5">
                            <div class="dataTables_info mb-2">
                                Mostrando {{ (table.page - 1) * table.pageSizeValue + paginados.length }} de {{
                                table.total$ | async }} registros
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-5">
                            <div class="text-md-right float-md-end gridjs-pagination">
                                <pagination [totalItems]="(table.total$ | async) || 0" [(ngModel)]="table.page"
                                    [itemsPerPage]="table.pageSizeValue" (pageChanged)="table.setPage($event.page)">
                                </pagination>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</div>