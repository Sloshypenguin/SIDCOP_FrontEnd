<app-breadcrumbs
  [title]="'Listas de Precios'"
  [breadcrumbItems]="breadCrumbItems"
>
  <img class="breadcrumbs-icon ms-2 icon-breadcrumb" style="width: 14vh; height: 12vh;" 
       src="assets/images/imagenes/FACTURADOS.svg" alt="icono breadcrumb" />
</app-breadcrumbs>

<div class="row">
  <div class="col-lg-12">
    <div class="card">

      <div class="card-body">

        <!-- Product Selector -->
        <div class="mb-3">
          <ng-select
            [items]="productosLista"
            bindLabel="prod_Descripcion"
            [(ngModel)]="productoSeleccionado"
            (change)="onProductoChange($event)"
            [searchable]="true"
            placeholder="Selecciona un Producto"
            [clearable]="true"
          >
          </ng-select>
        </div>

        <span>{{productoSeleccionado}}</span>

        <hr>

        <!-- Listas de precios -->
        <div *ngFor="let lista of listasAgrupadas; let i = index" class="mb-4">
          <div class="card extra-element-card border-primary shadow-lg" style="background: #f8f9fa;">
            <div 
              [ngClass]="{ 'rounded-bottom-2': lista.isCollapsed, 'rounded-bottom-0': !lista.isCollapsed }"
              class="card-header text-white position-relative" style="min-height: 3rem; background: #141a2e"
            >
              <span>Lista de Precios #{{ lista.listaId }}</span>
              <button
                class="btn btn-light btn-sm position-absolute end-0 top-0 m-2"
                type="button"
                (click)="toggleCollapse(lista)"
                aria-label="Toggle"
              >
                <i
                  [ngClass]="{
                    'ri-arrow-up-s-line': !lista.isCollapsed,
                    'ri-arrow-down-s-line': lista.isCollapsed
                  }"
                  class="fs-4"
                ></i>
              </button>
            </div>
            <div [collapse]="lista.isCollapsed">
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-3">
                    <label>Precio Contado</label>
                    <input type="text" class="form-control" [value]="lista.precioContado" disabled />
                  </div>
                  <div class="col-md-3">
                    <label>Precio Cr√©dito</label>
                    <input type="text" class="form-control" [value]="lista.precioCredito" disabled />
                  </div>
                  <div class="col-md-3">
                    <label>Inicio Escala</label>
                    <input type="text" class="form-control" [value]="lista.inicioEscala" disabled />
                  </div>
                  <div class="col-md-3">
                    <label>Fin Escala</label>
                    <input type="text" class="form-control" [value]="lista.finEscala" disabled />
                  </div>
                </div>

                <div *ngFor="let canal of canalesLista" class="mb-2">
                  <div class="card border-primary mb-2">
                    <div
                      class="card-header d-flex align-items-center justify-content-between"
                      style="cursor:pointer;"
                      (click)="canal.open = !canal.open"
                    >
                      <div (click)="$event.stopPropagation()">
                        <input type="checkbox"
                          [checked]="isCanalFullyChecked(lista, canal)"
                          [indeterminate]="isIndeterminate(lista, canal)"
                          (change)="toggleParentCheckbox(lista, canal, $event)">
                        <span class="ms-2">{{ canal.cana_Descripcion }}</span>
                      </div>
                      <i
                        [ngClass]="{
                          'ri-arrow-up-s-line': canal.open,
                          'ri-arrow-down-s-line': !canal.open
                        }"
                        class="fs-5"
                      ></i>
                    </div>

                    <div [collapse]="!canal.open">
                      <div class="card-body">
                        <div class="row">
                          <div *ngFor="let cliente of getClientesPorCanal(canal.cana_Id)" class="col-md-6">
                            <div class="form-check">
                              <input type="checkbox"
                                     [checked]="isClienteChecked(lista, cliente.clie_Id)"
                                     (change)="onChildCheckboxChange(lista, canal)">
                              <span class="ms-2">{{ cliente.clie_Nombres }} {{ cliente.clie_Apellidos }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div> <!-- card-body -->
    </div> <!-- card -->
  </div> <!-- col-lg-12 -->
</div> <!-- row -->
